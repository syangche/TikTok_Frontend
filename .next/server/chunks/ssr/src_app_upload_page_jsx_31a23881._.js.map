{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/sonamyangchen/Desktop/TikTok_Frontend/src/app/upload/page.jsx"],"sourcesContent":["// In src/app/upload/page.jsx\n'use client';\n\nimport { useState, useRef } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '../../contexts/authContext';\nimport { uploadVideoToStorage, uploadThumbnailToStorage, createVideo } from '@/services/uploadService';\nimport toast from 'react-hot-toast';\nimport { FaCloudUploadAlt, FaSpinner } from 'react-icons/fa';\n\nconst UploadPage = () => {\n  const { user, isAuthenticated } = useAuth();\n  const router = useRouter();\n  const [videoFile, setVideoFile] = useState(null);\n  const [thumbnailFile, setThumbnailFile] = useState(null);\n  const [videoPreview, setVideoPreview] = useState(null);\n  const [thumbnailPreview, setThumbnailPreview] = useState(null);\n  const [caption, setCaption] = useState('');\n  const [uploading, setUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const videoInputRef = useRef(null);\n  const thumbnailInputRef = useRef(null);\n\n  // Redirect if not authenticated\n  if (!isAuthenticated) {\n    router.push('/');\n    return null;\n  }\n\n  const handleVideoChange = (e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n\n    if (!file.type.startsWith('video/')) {\n      toast.error('Please select a video file');\n      return;\n    }\n\n    if (file.size > 100 * 1024 * 1024) {\n      toast.error('File size too large (max 100MB)');\n      return;\n    }\n\n    setVideoFile(file);\n    setVideoPreview(URL.createObjectURL(file));\n  };\n\n  const handleThumbnailChange = (e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n\n    if (!file.type.startsWith('image/')) {\n      toast.error('Please select an image file for the thumbnail');\n      return;\n    }\n\n    setThumbnailFile(file);\n    setThumbnailPreview(URL.createObjectURL(file));\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    if (!videoFile) {\n      toast.error('Please select a video to upload');\n      return;\n    }\n\n    if (!caption.trim()) {\n      toast.error('Please add a caption');\n      return;\n    }\n\n    try {\n      setUploading(true);\n      setUploadProgress(0);\n      \n      // Step 1: Upload video directly to Supabase\n      const uploadToast = toast.loading('Uploading video... 0%');\n      \n      const videoUploadResult = await uploadVideoToStorage(user.id, videoFile);\n      setUploadProgress(50);\n      toast.loading('Uploading video... 50%', { id: uploadToast });\n      \n      let thumbnailUploadResult = null;\n      if (thumbnailFile) {\n        thumbnailUploadResult = await uploadThumbnailToStorage(user.id, thumbnailFile);\n      }\n      \n      setUploadProgress(75);\n      toast.loading('Uploading video... 75%', { id: uploadToast });\n      \n      // Step 2: Create video in the database with the Supabase URLs\n      const videoData = {\n        caption,\n        videoUrl: videoUploadResult.url,\n        videoStoragePath: videoUploadResult.storagePath,\n      };\n      \n      if (thumbnailUploadResult) {\n        videoData.thumbnailUrl = thumbnailUploadResult.url;\n        videoData.thumbnailStoragePath = thumbnailUploadResult.storagePath;\n      }\n      \n      await createVideo(videoData);\n      \n      setUploadProgress(100);\n      toast.success('Video uploaded successfully!', { id: uploadToast });\n      router.push('/');\n    } catch (error) {\n      console.error('Upload error:', error);\n      toast.error(error.message || 'Failed to upload video');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  return (\n    <div className=\"max-w-3xl mx-auto p-4\">\n      <h1 className=\"mb-6 text-2xl font-bold\">Upload Video</h1>\n\n      <div className=\"rounded-lg border border-gray-200 p-6\">\n        <form onSubmit={handleSubmit}>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n            {/* Video upload area */}\n            <div className=\"flex flex-col\">\n              <h2 className=\"text-lg font-semibold mb-2\">Video</h2>\n              {videoPreview ? (\n                <div className=\"mb-4 aspect-video w-full overflow-hidden rounded-lg bg-black\">\n                  <video\n                    src={videoPreview}\n                    className=\"h-full w-full object-contain\"\n                    controls\n                  />\n                </div>\n              ) : (\n                <div\n                  onClick={() => videoInputRef.current?.click()}\n                  className=\"flex aspect-video w-full cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 hover:bg-gray-100\"\n                >\n                  <FaCloudUploadAlt size={48} className=\"mb-2 text-gray-400\" />\n                  <p className=\"text-center text-gray-500\">\n                    Click to upload a video\n                    <br />\n                    <span className=\"text-sm\">MP4 or WebM (max 100MB)</span>\n                  </p>\n                </div>\n              )}\n              <input\n                type=\"file\"\n                ref={videoInputRef}\n                onChange={handleVideoChange}\n                accept=\"video/*\"\n                className=\"hidden\"\n              />\n              {videoFile && (\n                <p className=\"mt-2 text-sm text-gray-500\">\n                  Selected: {videoFile.name}\n                </p>\n              )}\n\n              {/* Thumbnail upload area */}\n              <h2 className=\"text-lg font-semibold mb-2 mt-6\">Thumbnail (Optional)</h2>\n              {thumbnailPreview ? (\n                <div className=\"mb-4 aspect-video w-full overflow-hidden rounded-lg bg-gray-100\">\n                  <img\n                    src={thumbnailPreview}\n                    alt=\"Thumbnail preview\"\n                    className=\"h-full w-full object-contain\"\n                  />\n                </div>\n              ) : (\n                <div\n                  onClick={() => thumbnailInputRef.current?.click()}\n                  className=\"flex aspect-video w-full cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 hover:bg-gray-100\"\n                >\n                  <FaCloudUploadAlt size={36} className=\"mb-2 text-gray-400\" />\n                  <p className=\"text-center text-gray-500\">\n                    Click to upload a thumbnail\n                    <br />\n                    <span className=\"text-sm\">JPG, PNG or GIF</span>\n                  </p>\n                </div>\n              )}\n              <input\n                type=\"file\"\n                ref={thumbnailInputRef}\n                onChange={handleThumbnailChange}\n                accept=\"image/*\"\n                className=\"hidden\"\n              />\n              {thumbnailFile && (\n                <p className=\"mt-2 text-sm text-gray-500\">\n                  Selected: {thumbnailFile.name}\n                </p>\n              )}\n            </div>\n\n            {/* Video details */}\n            <div>\n              <div className=\"mb-4\">\n                <label className=\"mb-1 block text-sm font-medium text-gray-700\">\n                  Caption\n                </label>\n                <textarea\n                  value={caption}\n                  onChange={(e) => setCaption(e.target.value)}\n                  className=\"w-full rounded-lg border border-gray-300 p-2\"\n                  rows=\"4\"\n                  placeholder=\"What's this video about?\"\n                  maxLength=\"150\"\n                ></textarea>\n                <p className=\"mt-1 text-right text-xs text-gray-500\">\n                  {caption.length}/150\n                </p>\n              </div>\n\n              {uploading && (\n                <div className=\"mb-4\">\n                  <div className=\"w-full bg-gray-200 rounded-full h-2.5\">\n                    <div \n                      className=\"bg-pink-500 h-2.5 rounded-full\" \n                      style={{ width: `${uploadProgress}%` }}\n                    ></div>\n                  </div>\n                  <p className=\"mt-1 text-center text-xs text-gray-500\">\n                    Uploading: {uploadProgress}%\n                  </p>\n                </div>\n              )}\n\n              <button\n                type=\"submit\"\n                disabled={uploading || !videoFile}\n                className=\"w-full rounded-lg bg-pink-500 py-3 text-white hover:bg-pink-600 disabled:bg-pink-300\"\n              >\n                {uploading ? (\n                  <span className=\"flex items-center justify-center\">\n                    <FaSpinner className=\"mr-2 animate-spin\" /> Uploading...\n                  </span>\n                ) : (\n                  'Post'\n                )}\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default UploadPage;"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 457, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}